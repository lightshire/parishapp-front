"use strict";angular.module("parishappFrontApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","datatables","ipCookie"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/users/index.html",controller:"UserCtrl"}).when("/person",{templateUrl:"views/users/index.html",controller:"UserCtrl"}).when("/person/:id",{templateUrl:"views/users/edit.html",controller:"UserEditCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/logout",{controller:"LogoutCtrl",templateUrl:"views/login.html"}).otherwise({redirectTo:"/"})}]),angular.module("parishappFrontApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("parishappFrontApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("parishappFrontApp").controller("UserCtrl",["Person","$scope","$modal","$location","ipCookie",function(a,b,c,d,e){var f=e("Auth-Token");return f?(b.openCreate=function(){var a=c.open({animation:!0,templateUrl:"views/users/modal.html",controller:"UsercreatemodalCtrl",size:"lg",resolve:{}});a.result.then(function(a){b.peoples.push(a)})},b.get_data=function(){var c=function(){a.get(d)},d=function(a){b.peoples=a.data};c()},void b.get_data()):void d.path("/login")}]),angular.module("parishappFrontApp").service("Config",["$http","ipCookie","$rootScope",function(a,b,c){return a.defaults.headers.common["Auth-Token"]=b("Auth-Token"),c.type=b("type"),c.logged_in=c.type||!1,{url:"http://php-parishapp.rhcloud.com/api",login:function(d,e){var f=this,g=function(){a({url:f.url+"/login",method:"post",data:d}).success(h).error(i)},h=function(d){a.defaults.headers.common["Auth-Token"]=b("Auth-Token"),c.type=b("type"),c.logged_in=c.type||!1,e(d)},i=function(){e("Cannot login.  A Server error has occured.")};g()},logout:function(d){var e=function(){b.remove("type"),b.remove("Auth-Token"),c.type=null,delete a.defaults.headers.common["Auth-Token"],d()};e()}}}]),angular.module("parishappFrontApp").service("User",["Config","$http",function(a,b){return{create:{},update:{},destroy:{},get:{}}}]),angular.module("parishappFrontApp").service("Record",["Config","$http",function(a,b){return{create:function(c,d){var e=function(){b({url:a.url+"/"+c.type+"s",data:c,method:"POST"}).success(d).error(f)},f=function(){d("An error has occured")};e()},update:function(c,d){var e=function(){c._method="PUT",b({url:a.url+"/"+c.type+"s/"+c.record.recordable_id,data:c,method:"POST"}).success(d).error(f)},f=function(){d("An error has occured")};e()},destroy:{},find:{},get:function(c,d,e){var f=function(){b({url:a.url+"/"+c+"s",params:{person_id:d}}).success(e).error(g)},g=function(){e("An error has occured")};f()},get_by_parent:function(c,d,e){var f=function(){b({url:a.url+"/"+c+"s",params:{parent_id:d.id,person_id:d.person_id}}).success(e).error(g)},g=function(){e("An error has occured.")};f()},merge:function(c,d,e){var f=function(){b({url:a.url+"/"+d+"s/actions/merge",method:"POST",data:c}).success(e).error(g)},g=function(){e("An error has occured. Cannot merge")};f()}}}]),angular.module("parishappFrontApp").service("Marriage",function(){return{create:{},update:{},destroy:{},get:{}}}),angular.module("parishappFrontApp").service("Person",["Config","$http",function(a,b){return{create:function(c,d){var e=function(){b({url:a.url+"/people",method:"POST",data:c}).success(d).error(f)},f=function(){d("an error has occured. cannot connect to the server")};e()},update:function(c,d){var e=function(){c._method="PUT",b({url:a.url+"/people/"+c.id,method:"POST",data:c}).success(d).error(f)},f=function(){d("an error has occured. cannot connect to the server")};e()},destroy:{},get:function(c){var d=function(){b({url:a.url+"/people",method:"GET"}).success(c).error(e)},e=function(){c("An error has occured. Cannot continue")};d()},find:function(c,d){var e=function(){b({url:a.url+"/people/"+c,method:"GET"}).success(d).error(f)},f=function(){d("An error ha occured. cannot find person")};e()}}}]),angular.module("parishappFrontApp").service("Baptism",function(){return{update:{},destroy:{},get:{}}}),angular.module("parishappFrontApp").service("Confirmation",function(){return{create:{},update:{},destroy:{},get:{}}}),angular.module("parishappFrontApp").controller("UsercreatemodalCtrl",["Person","$scope","$modalInstance",function(a,b,c){b.person={},b.ok=function(){var d=function(){a.create(b.person,e)},e=function(a){"string"==typeof a&&(b.error=!0,b.error_response=a),c.close(a.data)};d()}}]),angular.module("parishappFrontApp").controller("UserEditCtrl",["Person","Record","$scope","$rootScope","$routeParams","$modal","$location","ipCookie",function(a,b,c,d,e,f,g,h){var i=h("Auth-Token");return i?(c.openModal=function(a){f.open({animation:!0,templateUrl:"views/users/"+a+"-modal.html",controller:"UserRecordModalCtrl",size:"lg",resolve:{type:function(){return a},params:function(){return"n/a"},person_id:function(){return e.id}}})},c.open=function(a,b){f.open({animation:!0,templateUrl:"views/users/"+b+"-modal.html",controller:"UserRecordModalCtrl",size:"lg",resolve:{type:function(){return b},params:function(){return{_record:a,record:a.record}},person_id:function(){return e.id}}})},c.get_user=function(){var b=function(){a.find(e.id,d)},d=function(a){c.person=a.data};b()},c.get_baptisms=function(){var a=function(){b.get("baptism",e.id,d)},d=function(a){c.baptisms=a.data};a()},c.get_marriages=function(){var a=function(){b.get("marriage",e.id,d)},d=function(a){c.marriages=a.data};a()},c.get_confirmations=function(){var a=function(){b.get("confirmation",e.id,d)},d=function(a){c.confirmations=a.data};a()},c.ok=function(){var b=function(){a.update(c.person,d)},d=function(a){"string"==typeof a&&(c.error=!0,c.error_response=a),c.success=!0};b()},c.view_commits=function(a,b){f.open({animation:!0,templateUrl:"views/users/commits-"+b+"-modal.html",controller:"UserCommitsModalCtrl",size:"lg",resolve:{type:function(){return b},data:function(){return a}}})},c.get_user(),c.get_baptisms(),c.get_marriages(),void c.get_confirmations()):void g.path("/login")}]),angular.module("parishappFrontApp").controller("UserRecordModalCtrl",["Record","$scope","$modalInstance","type","params","person_id",function(a,b,c,d,e,f){b.data={},b.record={},"string"!=typeof e&&(b.data=e._record,b.record=e.record),b.data.person_id=f,b.ok=function(){var e=function(){a.create({data:b.data,record:b.record,type:d},g)},f=function(){a.update({data:b.data,record:b.record,type:d},g)},g=function(a){c.close(a.data)};return b.record.id?f():void e()}}]),angular.module("parishappFrontApp").controller("UserCommitsModalCtrl",["Record","$scope","data","type","$window",function(a,b,c,d,e){b.get_commits=function(){var e=function(){a.get_by_parent(d,c,f)},f=function(a){return"string"==typeof a?alert("An error has occured."):void(b.commits=a.data)};e()},b.merge=function(b){var c=function(){a.merge(b,d,f)},f=function(a){return"string"==typeof a?alert(a):void e.location.reload()};c()},b.get_commits()}]),angular.module("parishappFrontApp").controller("UserCommitCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("parishappFrontApp").controller("LoginCtrl",["Config","ipCookie","$location","$scope",function(a,b,c,d){d.login=function(){var e=function(){a.login(d.user,f)},f=function(a){return"string"===a?alert(a):(b("Auth-Token",a.data.token.token),b("type",a.data.role.role_name),void c.path("/"))};e()}}]),angular.module("parishappFrontApp").controller("LogoutCtrl",["$scope","$location","Config",function(a,b,c){c.logout(function(){b.path("/")})}]);